jQuery(document).ready(function($){function e(e,a,i){var n=jQuery("#finaldescStripe").data("currency-symbol");idcSetPriceText("lemonway",n,e),jQuery("#id-main-submit").text(a),jQuery("#id-main-submit").attr("name","submitPaymentLemonWay"),jQuery("#id-main-submit").removeAttr("disabled"),jQuery(".pay_selector").removeClass("active"),jQuery(this).addClass("active"),jQuery(".card-type-field").show(),r&&t?(jQuery("#stripe-input").hide(),jQuery(".card-type-field").hide(),jQuery(".card-number, .card-cvc, card-expiry-month, card-expiry-year").removeClass("required")):(jQuery(".pw").parents(".form-row").show(),jQuery(".cpw").parents(".form-row").show(),"non3dsecure"==i?(jQuery("#stripe-input").show(),jQuery(".card-number, .card-cvc, card-expiry-month, card-expiry-year").addClass("required")):(jQuery("#stripe-input").hide(),jQuery(".card-number, .card-cvc, card-expiry-month, card-expiry-year").removeClass("required")))}if(jQuery(".checkout-wrapper").length>0){var r=jQuery("#payment-form #stripe-input").data("idset"),t=jQuery("#stripe-input").data("customer-id"),a=jQuery("#payment-form").data("txn-type"),i=jQuery("#payment-form").data("renewable"),n=jQuery("#payment-form").data("type"),o=jQuery("#payment-form").data("limit-term"),s=jQuery("#payment-form").data("term-length"),u=jQuery(".product-price").text();"0"==idc_elw?jQuery("#payment-form #pay-with-lemonway").parent("div").remove():jQuery(".pay_selector:visible").length<=1&&e(u,idc_localization_strings.complete_checkout,idc_lemonway_method),jQuery("#card-type-hidden").val("0"),jQuery("#card_type_select").change(function(e){jQuery("#card-type-hidden").val(jQuery(this).val())}),jQuery(".pay_selector").click(function(e){"pay-with-lemonway"!==jQuery(this).attr("id")&&jQuery(".card-type-field").hide()}),jQuery("#payment-form #pay-with-lemonway").click(function(r){r.preventDefault(),e(u,idc_localization_strings.complete_checkout,idc_lemonway_method),jQuery(this).addClass("active"),jQuery(".finaldesc").hide(),jQuery("#finaldescStripe").show()}),jQuery(document).on("idcPaymentChecksAfter",function(e,n,o,s){if(e.preventDefault(),"submitPaymentLemonWay"==jQuery("#id-main-submit").attr("name")){jQuery(".payment-errors").text(""),jQuery("#id-main-submit").text(idc_localization_strings.processing+"...");var u=jQuery("#payment-form").data("product"),y=jQuery(".first-name").val(),c=jQuery(".last-name").val(),d=jQuery("#payment-form .email").val(),m=jQuery(".pw").val(),l=jQuery(".card-number").val(),p=jQuery(".card-expiry-month").val(),j=jQuery(".card-expiry-year").val();2==j.length&&(j="20"+j);var Q=p+"/"+j,_=jQuery(".card-cvc").val(),v={product_id:u,first_name:y,last_name:c,email:d,pw:m};if(console.log("idset: ",r,", customerId: ",t),r&&t)var h="customer";else var h="none";return"3dsecure"==idc_lemonway_method?(console.log("before sending ajax request"),jQuery.ajax({url:memberdeck_ajaxurl,type:"POST",data:{action:"idc_lemonway_checkout_method_details",Customer:v,PWYW:n,Renewable:i,ProductId:u,txnType:a,queryString:o,Fields:s.posts},success:function(e){if(json=JSON.parse(e),"success"==json.response){jQuery("#ppload").html(json.form).css("display","none");var r=jQuery("#card_type_select").val(),t=jQuery('#card_type_select option[value="'+r+'"]').html();t=t.toUpperCase(),jQuery('#ppload input[name="'+t+'"]').trigger("click")}else jQuery("#id-main-submit").removeAttr("disabled").val(idc_localization_strings.complete_checkout).removeClass("processing"),jQuery(".payment-errors").text(json.message)}})):jQuery.ajax({url:memberdeck_ajaxurl,type:"POST",data:{action:"idmember_create_customer",Source:"lemonway",Customer:v,Token:h,Card:l,Expiry:Q,CCode:_,Fields:s.posts,txnType:a,Renewable:i,PWYW:n},success:function(e){if(console.log(e),json=JSON.parse(e),"success"==json.response){var r=json.paykey,t=json.product,a=json.order_id,i=json.user_id,n=json.type,u=json.customer_id;jQuery(document).trigger("lemonWaySuccess",[a,u,i,t,r,s,n]),setTimeout(function(){window.location=memberdeck_durl+permalink_prefix+"idc_product="+t+"&paykey="+r+o},1e3)}else{jQuery("#id-main-submit").removeAttr("disabled").text("").removeClass("processing");"pay-with-paypal"==jQuery(".payment-type-selector .active").attr("id")?jQuery("#id-main-submit").text("Pay with Paypal"):jQuery("#id-main-submit").text(idc_localization_strings.continue_checkout),jQuery(".payment-errors").text(json.message)}}}),!1}})}jQuery("#upload_kyc_document").click(function(e){jQuery("#payment-settings").attr("enctype","multipart/form-data"),jQuery("#kyc_document_uploaded").val("yes"),jQuery("#payment-settings").submit()})});
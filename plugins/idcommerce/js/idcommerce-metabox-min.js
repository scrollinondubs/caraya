var idcf_idc_selected_level="";jQuery(document).ready(function(){var e=jQuery("input[name='protect-choice']:checked").val();if("no"==e||void 0==e||0==e?jQuery("#level-check").hide():jQuery("#level-check").show(),jQuery("input[name='protect-choice']").click(function(){var e=jQuery("input[name='protect-choice']:checked").val();console.log(e),"no"==e||void 0==e||0==e?jQuery("#level-check").hide():jQuery("#level-check").show()}),jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idmember_get_levels"},success:function(e){json=JSON.parse(e),jQuery.each(json,function(){jQuery("#md-level").append('<option value="'+this.id+'">'+this.level_name+"</option>")});var l=jQuery("#md-level").val();l>0&&(jQuery(".md-product").text(l),jQuery("#md-level").change(function(){l=jQuery("#md-level").val(),jQuery(".md-product").text(l)}))}}),jQuery(document).on("change",'[name*="level_idc_product"]',function(e){var l=jQuery(this).attr("id").replace("level_idc_product_","");if("add_new_product"==jQuery(this).val())openLBGlobal(jQuery(".idc_add_product_popup")),jQuery(this).parents(".projectmeta-levelbox").children(".ign_level_selected_option").find("#idc_product_selected_"+l).val(""),idcf_idc_selected_level=jQuery(this);else{var r=jQuery(this).parents(".projectmeta-levelbox").children(".ign_level_selected_option").find("#idc_product_selected_"+l);""!==jQuery(this).val()?jQuery(r).val("old_level"):jQuery(r).val("")}}),jQuery('[id="level_idc_product[]"]').attr("id","level_idc_product_1"),jQuery('label[for="level_idc_product[]"]').attr("for","level_idc_product_1"),jQuery("#id-idc-add-product-popup").length>0&&(jQuery("#id-idc-add-product-popup").hide(),jQuery(document).on("idcfAddLevelAfter",function(e,l){var r=jQuery(jQuery(".ign_idc_level_select").get(0)).clone();jQuery(r).find('[name="level_idc_product_1"]').attr("name","level_idc_product_"+l),jQuery(r).find('[id="level_idc_product_1"]').attr("id","level_idc_product_"+l),jQuery(r).find('label[for="level_idc_product_1"]').attr("for","level_idc_product_"+l);var c=jQuery(jQuery(".ign_level_selected_option").get(0)).clone();jQuery(c).find('[id="idc_product_selected_1"]').attr("id","idc_product_selected_"+l),jQuery(c).find('[name="idc_product_selected_1"]').attr("name","idc_product_selected_"+l),jQuery('.projectmeta-levelbox[level="'+l+'"]').children(".ign_projectmeta_reward_title").after(jQuery(r)),jQuery('.projectmeta-levelbox[level="'+l+'"]').children(".ign_idc_level_select").after(jQuery(c))}),get_levels(),jQuery("#renewal_price").parents(".form-input").hide(),jQuery("#idc-new-level-submit").click(function(e){e.preventDefault(),jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idc_id_add_product","level-name":jQuery('[name="level-name"]').val(),"level-price":jQuery('[name="level-price"]').val(),"product-type":jQuery('[name="product-type"]').val(),"credit-value":jQuery('[name="credit-value"]').val(),"txn-type":jQuery('[name="txn-type"]').val(),"level-type":jQuery('[name="level-type"]').val(),"recurring-type":jQuery('[name="recurring-type"]').val(),plan:jQuery('[name="plan"]').val(),limit_term:jQuery('[name="limit_term"]').is(":checked")?"1":"",term_length:jQuery('[name="term_length"]').val(),"license-count":jQuery('[name="license-count"]').val(),enable_renewals:jQuery('[name="enable_renewals"]').is(":checked")?"1":"",renewal_price:jQuery('[name="renewal_price"]').val(),enable_multiples:jQuery('[name="enable_multiples"]').is(":checked")?"1":"",create_page:jQuery('[name="create_page"]').is(":checked")?"1":"",enable_combine_products:jQuery('[name="enable_combine_products"]').is(":checked")?"1":"",combined_recurring_product:jQuery('[name="combined_recurring_product"]').val()},success:function(e){console.log(e),json=JSON.parse(e),"success"==json.response&&(jQuery(".ign_idc_level_select").each(function(e,l){var r=jQuery(this).find('option[value="'+json.product_id+'"]'),c=jQuery(this).find('[name="level_idc_product_'+(e+1)+'"]');console.log("level_option.length: ",r.length),r.length<1&&(console.log("level name: ",jQuery("#level-name").val()),jQuery(c).append(jQuery("<option/>",{value:json.product_id,text:jQuery("#level-name").val()})),console.log("json.product_id: ",json.product_id),console.log("idcf_idc_selected_level: ",idcf_idc_selected_level),jQuery(idcf_idc_selected_level).val(json.product_id))}),closeLBGlobal(),idcf_idc_selected_level="")}})}),"editpost"==jQuery("#hiddenaction").val())){var l=parseFloat(jQuery('[name="level-count"]').val());if(l>0){var r=jQuery("#post_ID").val();jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idc_id_get_project_levels",postId:r,levelsCount:l},success:function(e){console.log("idc_id_get_project_levels: ",e),json=JSON.parse(e);for(var r=0;r<l;r++)if(r>0){var c=r+1,t=jQuery(jQuery(".ign_idc_level_select").get(0)).clone();jQuery(t).find('[name="level_idc_product_1"]').attr("name","level_idc_product_"+c),jQuery(t).find('[id="level_idc_product_1"]').attr("id","level_idc_product_"+c),jQuery(t).find('label[for="level_idc_product_1"]').attr("for","level_idc_product_"+c);var d=jQuery(jQuery(".ign_level_selected_option").get(0)).clone();jQuery(d).find('[id="idc_product_selected_1"]').attr("id","idc_product_selected_"+c),jQuery(d).find('[name="idc_product_selected_1"]').attr("name","idc_product_selected_"+c),jQuery('.projectmeta-levelbox[level="'+c+'"]').children(".ign_projectmeta_reward_title").after(jQuery(t)),jQuery("#level_idc_product_"+c).val(json.project_products[r]),jQuery('.projectmeta-levelbox[level="'+c+'"]').children(".ign_idc_level_select").after(jQuery(d)),jQuery("#idc_product_selected_"+c).val("old_level")}else jQuery("#level_idc_product_1").val(json.project_products[0])}})}}});
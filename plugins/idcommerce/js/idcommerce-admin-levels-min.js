function get_cperms(){jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idmember_get_cperms"},success:function(e){var r=JSON.parse(e);jQuery.each(r,function(e,r){jQuery('.cassign[value="'+r+'"]').attr("checked","checked")}),jQuery("#creator-permissions").change(function(){"2"==parseInt(jQuery("#creator-permissions").val())?jQuery("#allowed-creator-levels").show():jQuery("#allowed-creator-levels").hide()})}})}function get_levels(e){e=e||!1,jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idmember_get_levels"},success:function(r){levels=JSON.parse(r),jQuery.each(levels,function(){"active"!=this.product_status&&"1"!=e||(jQuery("#credit-assign").append(jQuery("<option/>",{value:this.id,text:this.level_name})),jQuery("#edit-level").append(jQuery("<option/>",{value:this.id,text:this.level_name})),jQuery("#default_product").append(jQuery("<option>",{value:this.id,text:this.level_name,selected:jQuery("#default_product").data("selected")==this.id})),jQuery("#occ_level").append(jQuery("<option/>",{value:this.id,text:this.level_name})),jQuery("#assign-checkbox").append(jQuery("<input/>",{type:"checkbox",name:"lassign[]",class:"lassign",id:"assign-"+this.id,value:this.id})),jQuery("#assign-checkbox").append(jQuery("<label/>",{text:this.level_name,for:"assign-"+this.id})),jQuery("#assign-checkbox").append("<br/>"),jQuery("select[name='export_product_choice']").append(jQuery("<option/>",{value:this.id,text:this.level_name})),jQuery("#allowed-creator-levels").append(jQuery("<input/>",{type:"checkbox",name:"cassign[]",class:"cassign",id:"cperm-"+this.id,value:this.id})),jQuery("#allowed-creator-levels").append(jQuery("<label/>",{text:this.level_name,for:"cperm-"+this.id})),jQuery("#allowed-creator-levels").append("<br/>"),jQuery("#upgrade-levels").append(jQuery("<option/>",{value:this.id,text:this.level_name})))}),jQuery("#edit-level").change(function(){var e=parseInt(jQuery("#edit-level").val());if(jQuery(this).val()==idc_localization_strings.choose_product?(jQuery(".list-shortcode").hide(),jQuery('input[name="create_page"]').removeAttr("disabled").removeAttr("checked")):(jQuery(".list-shortcode").show(),jQuery('input[name="create_page"]').attr("disabled","disabled")),e>0){jQuery("#product-status").val(levels[e].product_status),jQuery("#product-type").val(levels[e].product_type),jQuery("#level-name").val(levels[e].level_name),jQuery("#level-price").val(levels[e].level_price),jQuery("#credit-value").val(levels[e].credit_value),jQuery("#txn-type").val(levels[e].txn_type),jQuery("#level-type").val(levels[e].level_type),levels[e].recurring_type.length>0?jQuery("#recurring-type").val(levels[e].recurring_type):jQuery("#recurring-type").val("monthly");1==levels[e].trial_period?jQuery("#trial_period").attr("checked","checked"):jQuery("#trial_period").removeAttr("checked"),jQuery("#trial_length").val(levels[e].trial_length),levels[e].trial_type.length>0?jQuery("#trial-type").val(levels[e].trial_type):jQuery("#trial-type").val("day");1==levels[e].limit_term?jQuery("#limit_term").attr("checked","checked"):jQuery("#limit_term").removeAttr("checked"),jQuery("#term_length").val(levels[e].term_length),jQuery("#plan").val(levels[e].plan),jQuery("#license-count").val(levels[e].license_count);1==levels[e].enable_renewals?(jQuery("#enable_renewals").attr("checked","checked"),jQuery("#renewal_price").parents(".form-input").show()):(jQuery("#enable_renewals").removeAttr("checked"),jQuery("#renewal_price").parents(".form-input").hide());1==levels[e].enable_multiples?jQuery("#enable_multiples").attr("checked","checked"):jQuery("#enable_multiples").removeAttr("checked"),"0"!==levels[e].combined_product?(jQuery("#combined_recurring_product").val(levels[e].combined_product),jQuery(".combine-products-checkbox").removeClass("hide"),jQuery("#enable_combine_products").attr("checked","checked"),jQuery(".combine-products-selection").removeClass("hide")):(jQuery("#combined_recurring_product").val(""),jQuery("#enable_combine_products").removeAttr("checked"),jQuery(".combine-products-selection").addClass("hide"));1==levels[e].custom_message?jQuery("#custom_message").attr("checked","checked"):jQuery("#custom_message").removeAttr("checked"),jQuery("#renewal_price").val(levels[e].renewal_price),jQuery("#level-submit").val(idc_localization_strings.update),jQuery("#level-delete").show(),jQuery(".list-shortcode").text(idc_localization_strings.purchase_form_shortcode+': [idc_checkout product="'+e+'"]')}else jQuery("#product-status").val("active"),jQuery("#product-type").val("purchase"),jQuery("#level-name").val(""),jQuery("#level-price").val(""),jQuery("#credit-value").val(0),jQuery("#txn-type").val("capture"),jQuery("#plan").val(""),jQuery("#limit_term").removeAttr("checked"),jQuery("#term_length").val(""),jQuery("#license-count").val(""),jQuery("#enable_renewals").removeAttr("checked"),jQuery("#renewal_price").val(""),jQuery("#enable_multiples").removeAttr("checked"),jQuery("#level-submit").val("Create"),jQuery("#level-delete").hide(),jQuery("#custom_message").removeAttr("checked");var r=jQuery("#level-type").val(),l=idc_level_get_all_level_meta(e);idc_level_form_switch()});var l=jQuery("#level-type").val();jQuery("#level-type").change(function(){idc_level_form_switch()}),jQuery("#enable_renewals").change(function(){"checked"==jQuery("#enable_renewals").attr("checked")?jQuery("#renewal_price").parents(".form-input").show():jQuery("#renewal_price").parents(".form-input").hide()}),jQuery("#select-upgradable-pathway").change(function(e){jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idc_pathway_details",pathway_id:jQuery("#select-upgradable-pathway").val()},success:function(e){if(json=JSON.parse(e),"success"==json.response){var r=json.upgrade_pathways;console.log("pathways: ",r),jQuery("#pathway-name").val(json.pathway_name),jQuery("#upgrade-levels").val(r)}}})}),jQuery("#enable_combine_products").change(function(e){jQuery(this).is(":checked")?jQuery(".combine-products-selection").removeClass("hide"):jQuery(".combine-products-selection").addClass("hide")}),get_cperms(),idc_level_form_switch()}})}function idc_level_get_all_level_meta(e){jQuery.ajax({url:md_ajaxurl,type:"POST",data:{action:"idc_level_get_all_level_meta",id:e},success:function(e){void 0!==typeof meta&&(json=JSON.parse(e),idc_print_level_meta(json))},error:function(){}})}function idc_print_level_meta(e){jQuery.each(e,function(e,r){if(void 0!==typeof r){var l=jQuery('div[data-meta-key="'+r.meta_key+'"]');jQuery.each(r.meta_value,function(e,t){jQuery(l).find(" ."+r.meta_key+'[data-key-label="'+e+'"]').val(t)})}})}function idc_level_form_switch(){switch(jQuery("#level-type").val()){case"recurring":jQuery("#recurring-input").show(),jQuery("#license-input").hide(),jQuery(".combine-products-checkbox").addClass("hide"),jQuery(".combine-products-selection").addClass("hide");break;case"standard":jQuery("#recurring-input").hide(),jQuery("#license-input").show(),jQuery(".combine-products-checkbox").removeClass("hide");break;default:jQuery("#recurring-input").hide(),jQuery("#license-input").hide(),jQuery(".combine-products-checkbox").removeClass("hide");break}}